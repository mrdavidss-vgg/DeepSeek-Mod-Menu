name: Auto Build DeepSeek V1 DLL

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build-dll:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v4

    # Step 1: Create source code
    - name: Create DLL Source Code
      shell: pwsh
      run: |
        New-Item -ItemType Directory -Path src -Force | Out-Null
        @'
// Auto-generated DeepSeek V1 DLL
#include <windows.h>

BOOL APIENTRY DllMain(HMODULE hModule, DWORD reason, LPVOID reserved)
{
    return TRUE;
}

// Export your functions here
extern "C" __declspec(dllexport) void DeepSeek_Function() {}
'@ | Out-File -FilePath src/DeepSeekV1.cpp -Encoding ascii

    # Step 2: Set up Developer Command Prompt environment
    - name: Setup Developer Command Prompt
      uses: ilammy/msvc-dev-cmd@v1

    # Step 3: Compile the DLL using cl.exe
    - name: Build DLL with cl.exe
      shell: cmd
      run: |
        cl /LD src\DeepSeekV1.cpp /Fe:DeepSeekV1.dll

        if not exist DeepSeekV1.dll (
          echo ::error::DLL build failed
          exit 1
        )

    # Step 4: Upload DLL Artifact
    - name: Upload DLL Artifact
      uses: actions/upload-artifact@v4
      with:
        name: DeepSeekV1-Menu-DLL
        path: DeepSeekV1.dll
        if-no-files-found: error
        retention-days: 7

    # Step 5: Show Build Output
    - name: Show Build Output
      shell: pwsh
      run: |
        Get-ChildItem -Path .\DeepSeekV1.dll
        Write-Output "DLL built successfully!"
